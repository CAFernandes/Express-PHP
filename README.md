# Express PHP Microframework

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![PHP Version](https://img.shields.io/badge/PHP-8.1%2B-blue.svg)](https://php.net)
[![PHPStan Level](https://img.shields.io/badge/PHPStan-Level%208-brightgreen.svg)](https://phpstan.org/)
[![GitHub Issues](https://img.shields.io/github/issues/CAFernandes/express-php)](https://github.com/CAFernandes/express-php/issues)
[![GitHub Stars](https://img.shields.io/github/stars/CAFernandes/express-php)](https://github.com/CAFernandes/express-php/stargazers)

**Express PHP** √© um microframework leve, r√°pido e seguro inspirado no Express.js para construir aplica√ß√µes web modernas e APIs em PHP com otimiza√ß√µes integradas e sistema nativo de autentica√ß√£o.

> ‚ö° **Otimizado**: Cache integrado, roteamento por grupos, pipeline de middlewares otimizado e CORS ultra-r√°pido!

## üöÄ In√≠cio R√°pido

### Instala√ß√£o

```bash
composer require cafernandes/express-php
```

### Exemplo B√°sico

```php
<?php
require_once 'vendor/autoload.php';

use Express\ApiExpress;
use Express\Middleware\Security\SecurityMiddleware;
use Express\Middleware\Security\CorsMiddleware;

$app = new ApiExpress();

// Aplicar middlewares de seguran√ßa
$app->use(new SecurityMiddleware());
$app->use(new CorsMiddleware());

// Rota b√°sica
$app->get('/', function($req, $res) {
    $res->json(['message' => 'Ol√° Express PHP!']);
});

// Rota protegida com autentica√ß√£o
$app->post('/api/users', function($req, $res) {
    // Dados automaticamente sanitizados pelo middleware de seguran√ßa
    $userData = $req->body;
    $res->json(['message' => 'Usu√°rio criado', 'data' => $userData]);
});

$app->run();
```

## ‚ú® Principais Recursos

- üîê **Autentica√ß√£o Multi-m√©todo**: JWT, Basic Auth, Bearer Token, API Key
- üõ°Ô∏è **Seguran√ßa Avan√ßada**: CSRF, XSS, Rate Limiting, Headers de Seguran√ßa
- üì° **Streaming**: Suporte completo para streaming de dados, SSE e arquivos grandes
- üìö **Documenta√ß√£o OpenAPI/Swagger**: Gera√ß√£o autom√°tica de documenta√ß√£o
- üéØ **Middlewares Modulares**: Sistema flex√≠vel de middlewares
- ‚ö° **Performance**: Otimizado para alta performance
- üß™ **Testado**: 186+ testes unit√°rios e 100% de cobertura de c√≥digo
- üìä **An√°lise Est√°tica**: PHPStan Level 8 compliance

## üìñ Documenta√ß√£o

- **[üöÄ Guia de In√≠cio](docs/guides/starter/README.md)** - Comece aqui!
- **[üìö Documenta√ß√£o Completa](docs/README.md)** - Documenta√ß√£o detalhada
- **[üîê Sistema de Autentica√ß√£o](docs/pt-br/AUTH_MIDDLEWARE.md)** - Guia de autentica√ß√£o
- **[üì° Streaming de Dados](docs/pt-br/STREAMING.md)** - Streaming e Server-Sent Events
- **[üõ°Ô∏è Middlewares de Seguran√ßa](docs/guides/SECURITY_IMPLEMENTATION.md)** - Seguran√ßa
- **[üìù Exemplos Pr√°ticos](examples/)** - Exemplos prontos para usar

## üéØ Exemplos de Aprendizado

O framework inclui exemplos pr√°ticos e funcionais para facilitar o aprendizado:

- **[‚≠ê B√°sico](examples/example_basic.php)** - API REST b√°sica e conceitos fundamentais
- **[üîê Autentica√ß√£o Completa](examples/example_auth.php)** - Sistema completo de autentica√ß√£o
- **[üîë Autentica√ß√£o Simples](examples/example_auth_simple.php)** - JWT b√°sico e controle de acesso
- **[üõ°Ô∏è Middlewares](examples/example_middleware.php)** - CORS, rate limiting e valida√ß√£o
- **[ÔøΩ Documenta√ß√£o OpenAPI](examples/example_openapi_docs.php)** - Swagger UI autom√°tico e especifica√ß√£o OpenAPI
- **[ÔøΩüöÄ App Completo](examples/example_complete_optimizations.php)** - Aplica√ß√£o completa com todos os recursos

## üõ°Ô∏è Sistema de Autentica√ß√£o

```php
// Autentica√ß√£o JWT
$app->use(AuthMiddleware::jwt('sua_chave_secreta'));

// M√∫ltiplos m√©todos de autentica√ß√£o
$app->use(new AuthMiddleware([
    'authMethods' => ['jwt', 'basic', 'apikey'],
    'jwtSecret' => 'sua_chave_jwt',
    'basicAuthCallback' => 'validarUsuario',
    'apiKeyCallback' => 'validarApiKey'
]));

// Acessar dados do usu√°rio autenticado
$app->get('/profile', function($req, $res) {
    $user = $req->user; // dados do usu√°rio autenticado
    $method = $req->auth['method']; // m√©todo de auth usado
    $res->json(['user' => $user, 'auth_method' => $method]);
});
```

## üì° Streaming de Dados

O Express-PHP oferece suporte completo para streaming de dados em tempo real:

```php
// Streaming de texto simples
$app->get('/stream/text', function($req, $res) {
    $res->startStream('text/plain; charset=utf-8');

    for ($i = 1; $i <= 10; $i++) {
        $res->write("Chunk {$i}\n");
        sleep(1); // Simula processamento
    }

    $res->endStream();
});

// Server-Sent Events (SSE)
$app->get('/events', function($req, $res) {
    $res->sendEvent('Conex√£o estabelecida', 'connect');

    for ($i = 1; $i <= 10; $i++) {
        $data = ['counter' => $i, 'timestamp' => time()];
        $res->sendEvent($data, 'update', (string)$i);
        sleep(1);
    }
});

// Streaming de arquivos grandes
$app->get('/download/:file', function($req, $res) {
    $filePath = "/path/to/{$req->params['file']}";

    $headers = [
        'Content-Disposition' => 'attachment; filename="' . basename($filePath) . '"'
    ];

    $res->streamFile($filePath, $headers);
});

// Streaming de dados JSON
$app->get('/data/export', function($req, $res) {
    $res->startStream('application/json');
    $res->write('[');

    for ($i = 1; $i <= 1000; $i++) {
        if ($i > 1) $res->write(',');
        $res->writeJson(['id' => $i, 'data' => "Item {$i}"]);
    }

    $res->write(']');
    $res->endStream();
});
```

### Recursos de Streaming

- **Streaming de Texto**: Para logs e dados em tempo real
- **Server-Sent Events**: Para dashboards e notifica√ß√µes
- **Streaming de Arquivos**: Para downloads de arquivos grandes
- **Streaming de JSON**: Para exports e APIs de dados
- **Buffer Customiz√°vel**: Controle fino sobre performance
- **Heartbeat**: Manuten√ß√£o de conex√µes SSE ativas

## üìö Documenta√ß√£o OpenAPI/Swagger Nativa

O Express PHP possui um sistema nativo para gerar documenta√ß√£o OpenAPI 3.0 (Swagger) automaticamente das suas rotas. A documenta√ß√£o √© criada a partir dos metadados definidos nas rotas.

### üöÄ Como Ativar

```php
<?php
require_once 'vendor/autoload.php';

use Express\ApiExpress;
use Express\Utils\OpenApiExporter;
use Express\Routing\Router;

$app = new ApiExpress();

// Definir rotas com metadados para documenta√ß√£o
$app->get('/api/users', function($req, $res) {
    $res->json(['users' => []]);
}, [
    'summary' => 'Listar usu√°rios',
    'description' => 'Retorna uma lista de todos os usu√°rios cadastrados',
    'tags' => ['Usu√°rios'],
    'responses' => [
        '200' => [
            'description' => 'Lista de usu√°rios retornada com sucesso',
            'content' => [
                'application/json' => [
                    'schema' => [
                        'type' => 'object',
                        'properties' => [
                            'users' => ['type' => 'array']
                        ]
                    ]
                ]
            ]
        ]
    ]
]);

$app->get('/api/users/:id', function($req, $res) {
    $id = $req->getParam('id');
    $res->json(['user' => ['id' => $id]]);
}, [
    'summary' => 'Buscar usu√°rio por ID',
    'description' => 'Retorna os dados de um usu√°rio espec√≠fico',
    'tags' => ['Usu√°rios'],
    'parameters' => [
        'id' => [
            'type' => 'integer',
            'description' => 'ID √∫nico do usu√°rio',
            'required' => true
        ]
    ],
    'responses' => [
        '200' => [
            'description' => 'Usu√°rio encontrado',
            'content' => [
                'application/json' => [
                    'schema' => [
                        'type' => 'object',
                        'properties' => [
                            'user' => [
                                'type' => 'object',
                                'properties' => [
                                    'id' => ['type' => 'integer'],
                                    'name' => ['type' => 'string'],
                                    'email' => ['type' => 'string']
                                ]
                            ]
                        ]
                    ]
                ]
            ]
        ],
        '404' => ['description' => 'Usu√°rio n√£o encontrado']
    ]
]);

// Criar endpoint para servir a documenta√ß√£o
$app->get('/docs/openapi.json', function($req, $res) {
    $docs = OpenApiExporter::export(Router::class, 'https://api.example.com');
    $res->json($docs);
});

// Opcional: Servir interface Swagger UI
$app->get('/docs', function($req, $res) {
    $html = '
    <!DOCTYPE html>
    <html>
    <head>
        <title>API Documentation</title>
        <link rel="stylesheet" type="text/css" href="https://unpkg.com/swagger-ui-dist@3.25.0/swagger-ui.css" />
    </head>
    <body>
        <div id="swagger-ui"></div>
        <script src="https://unpkg.com/swagger-ui-dist@3.25.0/swagger-ui-bundle.js"></script>
        <script>
        SwaggerUIBundle({
            url: "/docs/openapi.json",
            dom_id: "#swagger-ui",
            presets: [
                SwaggerUIBundle.presets.apis,
                SwaggerUIBundle.presets.standalone
            ]
        });
        </script>
    </body>
    </html>';

    $res->send($html);
});

$app->run();
```

### üìã Metadados Suportados

| Campo | Descri√ß√£o | Exemplo |
|-------|-----------|---------|
| `summary` | Resumo da opera√ß√£o | `'Criar usu√°rio'` |
| `description` | Descri√ß√£o detalhada | `'Cria um novo usu√°rio no sistema'` |
| `tags` | Grupos/categorias | `['Usu√°rios', 'API v1']` |
| `parameters` | Par√¢metros da rota | `['id' => ['type' => 'integer']]` |
| `queryParams` | Par√¢metros de consulta | `['limit' => ['type' => 'integer']]` |
| `responses` | Respostas poss√≠veis | `['200' => ['description' => 'OK']]` |
| `security` | Requisitos de autentica√ß√£o | `[['bearerAuth' => []]]` |

### üéØ Exemplo Avan√ßado com Valida√ß√£o

```php
// POST com valida√ß√£o e documenta√ß√£o completa
$app->post('/api/users', function($req, $res) {
    $userData = $req->body;
    // L√≥gica de cria√ß√£o do usu√°rio
    $res->status(201)->json(['message' => 'Usu√°rio criado', 'id' => 123]);
}, [
    'summary' => 'Criar novo usu√°rio',
    'description' => 'Cria um novo usu√°rio no sistema com valida√ß√£o completa',
    'tags' => ['Usu√°rios'],
    'requestBody' => [
        'required' => true,
        'content' => [
            'application/json' => [
                'schema' => [
                    'type' => 'object',
                    'required' => ['name', 'email'],
                    'properties' => [
                        'name' => [
                            'type' => 'string',
                            'minLength' => 2,
                            'maxLength' => 100,
                            'description' => 'Nome completo do usu√°rio'
                        ],
                        'email' => [
                            'type' => 'string',
                            'format' => 'email',
                            'description' => 'Email √∫nico do usu√°rio'
                        ],
                        'age' => [
                            'type' => 'integer',
                            'minimum' => 18,
                            'maximum' => 120,
                            'description' => 'Idade do usu√°rio (opcional)'
                        ]
                    ]
                ]
            ]
        ]
    ],
    'responses' => [
        '201' => [
            'description' => 'Usu√°rio criado com sucesso',
            'content' => [
                'application/json' => [
                    'schema' => [
                        'type' => 'object',
                        'properties' => [
                            'message' => ['type' => 'string'],
                            'id' => ['type' => 'integer']
                        ]
                    ]
                ]
            ]
        ],
        '400' => ['description' => 'Dados inv√°lidos'],
        '409' => ['description' => 'Email j√° existe']
    ],
    'security' => [['bearerAuth' => []]]
]);
```

### üîß Configura√ß√£o de Seguran√ßa

```php
// Adicionar esquemas de seguran√ßa √† documenta√ß√£o
$docs = OpenApiExporter::export(Router::class, 'https://api.example.com');

// Adicionar defini√ß√µes de seguran√ßa
$docs['components']['securitySchemes'] = [
    'bearerAuth' => [
        'type' => 'http',
        'scheme' => 'bearer',
        'bearerFormat' => 'JWT'
    ],
    'apiKeyAuth' => [
        'type' => 'apiKey',
        'in' => 'header',
        'name' => 'X-API-Key'
    ]
];

// Aplicar seguran√ßa globalmente
$docs['security'] = [
    ['bearerAuth' => []],
    ['apiKeyAuth' => []]
];
```

### üí° Dicas de Uso

1. **Acesse a documenta√ß√£o**: V√° para `/docs` para ver a interface Swagger UI
2. **JSON da API**: Endpoint `/docs/openapi.json` retorna a especifica√ß√£o OpenAPI
3. **Organize por tags**: Use tags para agrupar endpoints relacionados
4. **Documente erros**: Sempre inclua respostas de erro comuns (400, 401, 404, 500)
5. **Valide dados**: Use os schemas para documentar e validar entrada/sa√≠da
6. **Teste direto**: A interface Swagger permite testar endpoints diretamente

## ‚ö° Performance & Benchmarks

O Express PHP foi projetado para m√°xima performance. Execute nossos benchmarks para ver os resultados:

```bash
# Benchmark r√°pido (100 itera√ß√µes)
./benchmarks/run_benchmark.sh -q

# Benchmark completo (1000 itera√ß√µes)
./benchmarks/run_benchmark.sh

# Benchmark extensivo (10000 itera√ß√µes)
./benchmarks/run_benchmark.sh -f

# Todos os benchmarks + relat√≥rio abrangente
./benchmarks/run_benchmark.sh -a
```

### üéØ Resultados de Performance (√öltima Atualiza√ß√£o - PHP 8.1)

| Componente | Ops/Segundo | Tempo M√©dio | Grade |
|------------|-------------|-------------|-------|
| **CORS Headers Processing** | **45.6M** | **0.02 Œºs** | üèÜ |
| **Response Object Creation** | **20.9M** | **0.05 Œºs** | üèÜ |
| **JSON Encode (Small)** | **11.2M** | **0.09 Œºs** | ü•á |
| **XSS Protection Logic** | **4.4M** | **0.23 Œºs** | ü•á |
| **Route Pattern Matching** | **2.0M** | **0.49 Œºs** | ü•à |
| **Middleware Execution** | **1.4M** | **0.74 Œºs** | ü•à |
| **App Initialization** | **451K** | **2.22 Œºs** | ü•â |

### ‚ö° Caracter√≠sticas de Performance

- **Ultra Performance**: CORS com 45M+ opera√ß√µes/segundo
- **Baixo Overhead**: Apenas **1.36 KB** de mem√≥ria por inst√¢ncia
- **Cache Inteligente**: Hit ratio de **98%** para grupos de rotas
- **Escalabilidade**: Performance linear at√© 50K+ opera√ß√µes
- **Memory Efficient**: Sistema de cache de apenas **2KB** total

üìä **[Ver Relat√≥rio Abrangente](benchmarks/reports/COMPREHENSIVE_PERFORMANCE_SUMMARY.md)** | üõ†Ô∏è **[Executar Benchmarks](benchmarks/README.md)**

## üìö Documenta√ß√£o

### üöÄ **Guias Essenciais**
- **[üìñ Guia de Implementa√ß√£o R√°pida](docs/guides/QUICK_START_GUIDE.md)** - Setup completo em minutos
- **[üîß Middleware Personalizado](docs/guides/CUSTOM_MIDDLEWARE_GUIDE.md)** - Crie middleware sob medida
- **[ÔøΩÔ∏è Middlewares Padr√£o](docs/guides/STANDARD_MIDDLEWARES.md)** - Refer√™ncia completa dos middlewares inclusos
- **[ÔøΩüîí Seguran√ßa](docs/guides/SECURITY_IMPLEMENTATION.md)** - Boas pr√°ticas de seguran√ßa
- **[üìã √çndice Completo](docs/DOCUMENTATION_INDEX.md)** - Toda a documenta√ß√£o

### üìä **Performance & Benchmarks**
- **[üìà Benchmarks Completos](benchmarks/reports/COMPREHENSIVE_PERFORMANCE_SUMMARY.md)** - Performance detalhada
- **[üîß Como Executar Benchmarks](benchmarks/README.md)** - Testes de performance

### üéØ **Para Come√ßar**
1. **Iniciantes:** [Guia R√°pido](docs/guides/QUICK_START_GUIDE.md) ‚Üí Primeira API em 5 minutos
2. **Desenvolvedores:** [Middleware Avan√ßado](docs/guides/CUSTOM_MIDDLEWARE_GUIDE.md) ‚Üí Funcionalidades customizadas
3. **Produ√ß√£o:** [Seguran√ßa](docs/guides/SECURITY_IMPLEMENTATION.md) ‚Üí Deploy seguro

## ‚öôÔ∏è Requisitos

- **PHP**: 8.1.0 ou superior
- **Extens√µes**: json, session
- **Recomendado**: openssl, mbstring, fileinfo

## ü§ù Contribui√ß√£o

Contribui√ß√µes s√£o bem-vindas! Veja nosso [guia de contribui√ß√£o](CONTRIBUTING.md).

## üìÑ Licen√ßa

Este projeto est√° licenciado sob a [Licen√ßa MIT](LICENSE).

## üåü Suporte

- [Issues](https://github.com/CAFernandes/express-php/issues) - Reportar bugs ou solicitar recursos
- [Discussions](https://github.com/CAFernandes/express-php/discussions) - Perguntas e discuss√µes
- [Wiki](https://github.com/CAFernandes/express-php/wiki) - Documenta√ß√£o adicional

---

**üöÄ Pronto para come√ßar?** [Siga nosso guia de implementa√ß√£o r√°pida](docs/guides/QUICK_START_GUIDE.md)!
